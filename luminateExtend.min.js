/* luminateExtend.js | Version: 1.8.1 (23-FEB-2017) */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],function(b){return a(b,window,document)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jQuery"),window,document):a("undefined"==typeof jQuery&&"function"==typeof Zepto?Zepto:jQuery,window,document)}(function(a,b,c,d){var e=function(b){return b&&a.inArray(b,["es_US","en_CA","fr_CA","en_GB","en_AU"])<0&&(b="en_US"),b},f=function(a){return a&&(a=e(a),luminateExtend.sessionVars.set("locale",a)),a},g=function(a,b){return(a?luminateExtend.global.path.secure+"S":luminateExtend.global.path.nonsecure)+"PageServer"+(luminateExtend.global.routingId&&""!==luminateExtend.global.routingId?";"+luminateExtend.global.routingId:"")+"?pagename=luminateExtend_server&pgwrap=n"+(b?"&"+b:"")},h=function(c,d,e){if("function"==typeof d.getResponseHeader)if(0==d.status){var f=b.location.port,g=". You need to whitelist the domain and port API requests are originating from";""!==f?f=":"+f:g="";var h="Check your Luminate API settings to make sure "+b.location.hostname+f+" is whitelisted"+g;d=new luminateExtend.api.error(h)}else d=new luminateExtend.api.error(e);else if(c.responseFilter&&c.responseFilter.array&&c.responseFilter.filter&&luminateExtend.utils.stringToObj(c.responseFilter.array,d)){var j,k,i=c.responseFilter.filter.split("==")[0].split("!=")[0].replace(/^\s+|\s+$/g,"");if(c.responseFilter.filter.indexOf("!=")!==-1?(j="nequal",k=c.responseFilter.filter.split("!=")[1]):c.responseFilter.filter.indexOf("==")!==-1&&(j="equal",k=c.responseFilter.filter.split("==")[1]),j&&k){k=k.replace(/^\s+|\s+$/g,"");var l=[],m=!1;if(a.each(luminateExtend.utils.ensureArray(luminateExtend.utils.stringToObj(c.responseFilter.array,d)),function(){"nequal"===j&&this[i]===k||"equal"===j&&this[i]!==k?m=!0:l.push(this)}),m){var n=c.responseFilter.array.split(".");a.each(d,function(b,c){b===n[0]&&a.each(c,function(c,e){c===n[1]&&(2===n.length?d[b][c]=l:a.each(e,function(e,f){e===n[2]&&(3===n.length?d[b][c][e]=l:a.each(f,function(a,f){a===n[3]&&4===n.length&&(d[b][c][e][a]=l)}))}))})})}}}var o=a.noop;c.callback&&("function"==typeof c.callback?o=c.callback:c.callback.error&&d.errorResponse||d instanceof Error?o=c.callback.error:c.callback.success&&!d.errorResponse&&(o=c.callback.success));var p=c.data.indexOf("&method=login")!==-1&&c.data.indexOf("&method=loginTest")===-1,q=c.data.indexOf("&method=logout")!==-1;if(!p&&!q||d instanceof Error)o(d);else{var r=function(){o(d)},s={callback:r,useCache:!1,useHTTPS:c.useHTTPS};p&&d.loginResponse&&d.loginResponse.nonce&&(s.nonce="NONCE_TOKEN="+d.loginResponse.nonce),luminateExtend.api.getAuth(s)}};b.luminateExtend=function(a){luminateExtend.init(a||{})},luminateExtend.library={version:"1.8.1"},luminateExtend.global={update:function(b,c){b&&(b.length?c&&("locale"===b&&(c=f(c)),luminateExtend.global[b]=c):(b.locale&&(b.locale=f(b.locale)),luminateExtend.global=a.extend(luminateExtend.global,b)))}},luminateExtend.init=function(c){var d=a.extend({apiCommon:{},auth:{type:"auth"},path:{}},c||{});if(d.locale&&(d.locale=e(d.locale)),d.supportsCORS=!1,b.XMLHttpRequest){var f=new XMLHttpRequest;"withCredentials"in f&&(d.supportsCORS=!0)}return luminateExtend.global=a.extend(luminateExtend.global,d),luminateExtend},luminateExtend.api=function(a){luminateExtend.api.request(a||{})},luminateExtend.api.bind=function(c){return c=c||"form.luminateApi",a(c).length>0&&a(c).each(function(){"form"===this.nodeName.toLowerCase()&&a(this).bind("submit",function(c){c.cancelBubble=!0,c.returnValue=!1,c.stopPropagation&&(c.stopPropagation(),c.preventDefault()),a(this).attr("id")||a(this).attr("id","luminateApi-"+(new Date).getTime());var h,d=a(this).attr("action"),e=d.split("?"),f=a(this).data("luminateapi"),g=e[0].indexOf("/site/")!==-1?e[0].split("/site/")[1]:e[0],i=a(this).attr("enctype"),j=e.length>1?e[1]:"",k="#"+a(this).attr("id"),l=!1,m=!1;f&&(f.callback&&(h=luminateExtend.utils.stringToObj(f.callback)),f.requiresAuth&&"true"===f.requiresAuth&&(l=!0),(0===d.indexOf("https:")||"https:"===b.location.protocol&&d.indexOf("http")===-1)&&(m=!0)),luminateExtend.api.request({api:g,callback:h,contentType:i,data:j,form:k,requiresAuth:l,useHTTPS:m})})}),luminateExtend},luminateExtend.api.getAuth=function(b){var c=a.extend({useCache:!0,useHTTPS:!1},b||{});if(luminateExtend.api.getAuthLoad)if(luminateExtend.api.getAuthLoad=!1,c.useCache&&luminateExtend.global.auth.type&&luminateExtend.global.auth.token)luminateExtend.api.getAuthLoad=!0,c.callback&&c.callback();else{var d=function(a){luminateExtend.global.update(a),luminateExtend.api.getAuthLoad=!0,c.callback&&c.callback()};luminateExtend.global.supportsCORS?a.ajax({url:(c.useHTTPS?luminateExtend.global.path.secure:luminateExtend.global.path.nonsecure)+"CRConsAPI",data:"luminateExtend="+luminateExtend.library.version+(c.nonce&&""!==c.nonce?"&"+c.nonce:"")+"&api_key="+luminateExtend.global.apiKey+"&method=getLoginUrl&response_format=json&v=1.0",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){var b=a.getLoginUrlResponse,c=b.url,e=b.routing_id,f=b.JSESSIONID;e||c.indexOf("CRConsAPI;jsessionid=")===-1||(e=c.split("CRConsAPI;jsessionid=")[1].split("?")[0]),d({auth:{type:"auth",token:b.token},routingId:e?"jsessionid="+e:"",sessionCookie:f?"JSESSIONID="+f:""})}}):a.ajax({url:g(c.useHTTPS,"action=getAuth&callback=?"),dataType:"jsonp",success:d})}else{var e=function(){luminateExtend.api.getAuth(c)};setTimeout(e,1e3)}},luminateExtend.api.getAuthLoad=!0;var i=function(d){var e=a.extend({contentType:"application/x-www-form-urlencoded",data:"",requiresAuth:!1,useHTTPS:null},d||{}),f=["addressbook","advocacy","connect","cons","content","datasync","donation","email","group","orgevent","recurring","survey","teamraiser"];if(a.inArray(e.api.toLowerCase(),f)>=0&&(e.api="CR"+e.api.charAt(0).toUpperCase()+e.api.slice(1).toLowerCase()+"API",e.api=e.api.replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),luminateExtend.global.path.nonsecure&&luminateExtend.global.path.secure&&luminateExtend.global.apiKey&&e.api){"multipart/form-data"===e.contentType.split(";")[0]?e.contentType="multipart/form-data":e.contentType="application/x-www-form-urlencoded",e.contentType+="; charset=UTF-8",e.data="luminateExtend="+luminateExtend.library.version+(""===e.data?"":"&"+e.data),e.form&&a(e.form).length>0&&(e.data+="&"+a(e.form).eq(0).serialize()),e.data.indexOf("&api_key=")===-1&&(e.data+="&api_key="+luminateExtend.global.apiKey),luminateExtend.global.apiCommon.centerId&&e.data.indexOf("&center_id=")===-1&&(e.data+="&center_id="+luminateExtend.global.apiCommon.centerId),luminateExtend.global.apiCommon.categoryId&&e.data.indexOf("&list_category_id=")===-1&&(e.data+="&list_category_id="+luminateExtend.global.apiCommon.categoryId),e.data.indexOf("&response_format=xml")!==-1?e.data=e.data.replace(/&response_format=xml/g,"&response_format=json"):e.data.indexOf("&response_format=")===-1&&(e.data+="&response_format=json"),luminateExtend.global.apiCommon.source&&e.data.indexOf("&source=")===-1&&(e.data+="&source="+luminateExtend.global.apiCommon.source),luminateExtend.global.apiCommon.subSource&&e.data.indexOf("&sub_source=")===-1&&(e.data+="&sub_source="+luminateExtend.global.apiCommon.subSource),e.data.indexOf("&suppress_response_codes=")===-1&&(e.data+="&suppress_response_codes=true"),luminateExtend.global.locale&&e.data.indexOf("&s_locale=")===-1&&(e.data+="&s_locale="+luminateExtend.global.locale),e.data.indexOf("&v=")===-1&&(e.data+="&v=1.0");var i="http://",j=luminateExtend.global.path.nonsecure.split("http://")[1];"CRDonationAPI"===e.api||"CRTeamraiserAPI"===e.api||"CRConnectAPI"!==e.api&&("https:"===b.location.protocol&&null==e.useHTTPS||1==e.useHTTPS)?e.useHTTPS=!0:e.useHTTPS=!1,e.useHTTPS&&(i="https://",j=luminateExtend.global.path.secure.split("https://")[1]),i+=j+e.api;var k=!1,l=!1,m=!1;b.location.protocol===i.split("//")[0]&&c.domain===j.split("/")[0]?(k=!0,l=!0):luminateExtend.global.supportsCORS?l=!0:"postMessage"in b&&(m=!0);var n;l?n=function(){luminateExtend.global.routingId&&""!==luminateExtend.global.routingId&&(i+=";"+luminateExtend.global.routingId),e.requiresAuth&&e.data.indexOf("&"+luminateExtend.global.auth.type+"=")===-1&&(e.data+="&"+luminateExtend.global.auth.type+"="+luminateExtend.global.auth.token),luminateExtend.global.sessionCookie&&""!==luminateExtend.global.sessionCookie&&(e.data+="&"+luminateExtend.global.sessionCookie),e.data+="&ts="+(new Date).getTime(),a.ajax({url:i,data:e.data,xhrFields:{withCredentials:!0},contentType:e.contentType,dataType:"json",type:"POST"}).always(function(a,b,c){h(e,a,b)})}:m&&(n=function(){var d=(new Date).getTime(),f="luminateApiPostMessage"+d,j=g(e.useHTTPS,"action=postMessage");luminateExtend.global.routingId&&""!==luminateExtend.global.routingId&&(i+=";"+luminateExtend.global.routingId),e.requiresAuth&&e.data.indexOf("&"+luminateExtend.global.auth.type+"=")===-1&&(e.data+="&"+luminateExtend.global.auth.type+"="+luminateExtend.global.auth.token),luminateExtend.global.sessionCookie&&""!==luminateExtend.global.sessionCookie&&(e.data+="&"+luminateExtend.global.sessionCookie),e.data+="&ts="+d,luminateExtend.api.request.postMessageEventHandler||(luminateExtend.api.request.postMessageEventHandler={},luminateExtend.api.request.postMessageEventHandler.handler=function(b){if(luminateExtend.global.path.nonsecure.indexOf(b.origin)!==-1||luminateExtend.global.path.secure.indexOf(b.origin)!==-1){var c=a.parseJSON(b.data),d=c.postMessageFrameId,e=a.parseJSON(decodeURIComponent(c.response));luminateExtend.api.request.postMessageEventHandler[d]&&luminateExtend.api.request.postMessageEventHandler[d](d,e)}},"undefined"!=typeof b.addEventListener?b.addEventListener("message",luminateExtend.api.request.postMessageEventHandler.handler,!1):"undefined"!=typeof b.attachEvent&&b.attachEvent("onmessage",luminateExtend.api.request.postMessageEventHandler.handler)),luminateExtend.api.request.postMessageEventHandler[f]=function(b,c){h(e,c),a("#"+b).remove(),delete luminateExtend.api.request.postMessageEventHandler[b]},a("body").append('<iframe style="position: absolute; top: 0; left: -999em;" name="'+f+'" id="'+f+'"></iframe>'),a("#"+f).bind("load",function(){var b='{"postMessageFrameId": "'+a(this).attr("id")+'", "requestUrl": "'+i+'", "requestContentType": "'+e.contentType+'", "requestData": "'+e.data+'"}',d=i.split("/site/")[0].split("/admin/")[0];c.getElementById(a(this).attr("id")).contentWindow.postMessage(b,d)}),a("#"+f).attr("src",j)}),e.requiresAuth||!l&&!k&&!luminateExtend.global.sessionCookie?luminateExtend.api.getAuth({callback:n,useHTTPS:e.useHTTPS}):n()}};luminateExtend.api.request=function(b){if(a.isArray(b)){b.reverse();var c=[];a.each(b,function(d){var e=a.extend({async:!0},this);if(e.async||d===b.length-1)c.push(e);else{var f=b[d+1];if(f.callback&&"function"!=typeof f.callback){var g=f.callback.success||a.noop;f.callback.success=function(a){g(a),i(e)}}else{var f=b[d+1],h=f.callback||a.noop;f.callback={success:function(a){h(a),i(e)},error:function(a){h(a)}}}}}),c.reverse(),a.each(c,function(){i(this)})}else i(b)},luminateExtend.api.error=function(a){function b(a){this.name="LuminateError",this.default_message="Error communicating with the Luminate API. Check your Luminate API settings",this.message=a||this.default_message,this.stack=(new Error).stack}return b.prototype=Object.create(Error.prototype),b.prototype.constructor=b,new b(a)},luminateExtend.sessionVars={set:function(a,b,c){var d={};c&&(d.callback=c),a&&(d.data="s_"+a+"="+(b||""),luminateExtend.utils.ping(d))}},luminateExtend.tags=function(a,b){luminateExtend.tags.parse(a,b)},luminateExtend.tags.parse=function(b,d){luminateExtend.widgets?luminateExtend.widgets(b,d):(b=b&&"all"!==b?luminateExtend.utils.ensureArray(b):["cons"],d=d||"body",a.each(b,function(b,e){if("cons"===e){var f=a(d).find(c.getElementsByTagName("luminate:cons"));if(f.length>0){var g=function(b){f.each(function(){b.getConsResponse?a(this).replaceWith(luminateExtend.utils.stringToObj(a(this).attr("field"),b.getConsResponse)):a(this).remove()})};luminateExtend.api.request({api:"cons",callback:g,data:"method=getUser",requiresAuth:!0})}}}))},luminateExtend.utils={ensureArray:function(b){return a.isArray(b)?b:b?[b]:[]},stringToObj:function(a,c){var d=c||b;if(a)for(var e=a.split("."),f=0;f<e.length;f++){if(f<e.length-1&&!d[e[f]])return{};d=d[e[f]]}return d},ping:function(c){var d=a.extend({data:null},c||{}),e="luminatePing"+(new Date).getTime();a("body").append('<img style="position: absolute; left: -999em; top: 0;" id="'+e+'" />'),a("#"+e).bind("load",function(){a(this).remove(),d.callback&&d.callback()}),a("#"+e).attr("src",("https:"===b.location.protocol?luminateExtend.global.path.secure:luminateExtend.global.path.nonsecure)+"EstablishSession"+(luminateExtend.global.routingId&&""!==luminateExtend.global.routingId?";"+luminateExtend.global.routingId:"")+"?"+(null==d.data?"":d.data+"&")+"NEXTURL="+encodeURIComponent(("https:"===b.location.protocol?luminateExtend.global.path.secure:luminateExtend.global.path.nonsecure)+"PixelServer"))},simpleDateFormat:function(b,c,d){if(d=d||luminateExtend.global.locale,d=e(d),c=c||(a.inArray(d,["en_CA","fr_CA","en_GB","en_AU"])>=0?"d/M/yy":"M/d/yy"),b=b||new Date,!(b instanceof Date)){var f=b.split("T")[0].split("-"),g=b.split("T").length>1?b.split("T")[1].split(".")[0].split("Z")[0].split("-")[0].split(":"):["00","00","00"];b=new Date(f[0],f[1]-1,f[2],g[0],g[1],g[2])}var h=function(a){return a=""+a,0===a.indexOf("0")&&"0"!==a?a.substring(1):a},i=function(a){return a=Number(a),isNaN(a)?"00":(a<10?"0":"")+a},j={month:i(b.getMonth()+1),date:i(b.getDate()),year:i(b.getFullYear()),day:b.getDay(),hour24:b.getHours(),hour12:b.getHours(),minutes:i(b.getMinutes()),ampm:"AM"};j.hour24>11&&(j.ampm="PM"),j.hour24=i(j.hour24),0===j.hour12&&(j.hour12=12),j.hour12>12&&(j.hour12=j.hour12-12),j.hour12=i(j.hour12);var k,l=function(a){var b=a.replace(/yy+(?=y)/g,"yy").replace(/MMM+(?=M)/g,"MMM").replace(/d+(?=d)/g,"d").replace(/EEE+(?=E)/g,"EEE").replace(/a+(?=a)/g,"").replace(/k+(?=k)/g,"k").replace(/h+(?=h)/g,"h").replace(/m+(?=m)/g,"m"),c=b.replace(/yyy/g,j.year).replace(/yy/g,j.year.substring(2)).replace(/y/g,j.year).replace(/dd/g,j.date).replace(/d/g,h(j.date)),e=function(a,b,c){for(var d=1;d<a.length;d++)if(!isNaN(a[d].substring(0,1))){var e=a[d].substring(0,2);a[d]=a[d].substring(2),isNaN(e.substring(1))&&(a[d]=e.substring(1)+a[d],e=e.substring(0,1)),e=Number(e),e>23&&(e=23);var f="+"===c?e:0-e;"kk"===b||"k"===b?(f=Number(j.hour24)+f,f>24?f-=24:f<0&&(f+=24)):(f=Number(j.hour12)+f,f>24?f-=24:f<0&&(f+=24),f>12&&(f-=12)),f=""+f,"kk"!==b&&"hh"!==b||(f=i(f)),("h"===b&&0===f||"hh"===b&&"00"===f)&&(f="12"),a[d]=f+a[d]}return a.join("")};c.indexOf("k+")!==-1&&(c=e(c.split("kk+"),"kk","+"),c=e(c.split("k+"),"k","+")),c.indexOf("k-")!==-1&&(c=e(c.split("kk-"),"kk","-"),c=e(c.split("k-"),"k","-")),c=c.replace(/kk/g,j.hour24).replace(/k/g,h(j.hour24)),c.indexOf("h+")!==-1&&(c=e(c.split("hh+"),"hh","+"),c=e(c.split("h+"),"h","+")),c.indexOf("h-")!==-1&&(c=e(c.split("hh-"),"hh","-"),c=e(c.split("h-"),"h","-")),c=c.replace(/hh/g,j.hour12<12&&j.hour12.indexOf&&0!==j.hour12.indexOf("0")?"0"+j.hour12:j.hour12).replace(/h/g,h(j.hour12)),c=c.replace(/mm/g,j.minutes).replace(/m/g,h(j.minutes)),c=c.replace(/a/g,"A");var f=["January","February","march","april","may","June","July","august","September","October","November","December"];"es_US"===d&&(f=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]),"fr_CA"===d&&(f=["janvier","f&#233;vrier","mars","avril","mai","juin","juillet","ao&#251;t","septembre","octobre","novembre","d&#233;cembre"]),c=c.replace(/MMMM/g,f[Number(j.month)-1]).replace(/MMM/g,f[Number(j.month)-1].substring(0,3)).replace(/MM/g,j.month).replace(/M/g,h(j.month)).replace(/march/g,"March").replace(/may/g,"May").replace(/Mayo/g,"mayo");var g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return"es_US"===d&&(g=["domingo","lunes","martes","mi&eacute;rcoles","jueves","viernes","s&aacute;bado"]),"fr_CA"===d&&(g=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]),c=c.replace(/EEEE/g,g[j.day]).replace(/EEE/g,g[j.day].substring(0,3)).replace(/EE/g,g[j.day].substring(0,3)).replace(/E/g,g[j.day].substring(0,3)),c=c.replace(/A/g,j.ampm).replace(/april/g,"April").replace(/august/g,"August")};if(c.indexOf("'")!==-1){var m=c.replace(/\'+(?=\')/g,"''").split("''");if(1===m.length){m=c.split("'");for(var n=0;n<m.length;n++)n%2===0&&(m[n]=l(m[n]));return m.join("")}for(var n=0;n<m.length;n++){for(var o=m[n].split("'"),p=0;p<o.length;p++)p%2===0&&(o[p]=l(o[p]));m[n]=o.join("")}return m.join("'")}return k=l(c)}}});